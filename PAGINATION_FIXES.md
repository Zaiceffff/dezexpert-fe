# Исправления пагинации в проекте Dezexpert

## Проблемы, которые были исправлены

### 1. Неправильная логика пагинации
- **Было**: Пагинация работала с отфильтрованными данными на клиенте, а не с серверными данными
- **Стало**: Реализована серверная пагинация с правильной логикой

### 2. Несоответствие между totalOrders и filteredOrders
- **Было**: `totalPages` вычислялся на основе `totalOrders`, но отображались `filteredOrders`
- **Стало**: Все вычисления основаны на серверных данных

### 3. Отсутствие серверной пагинации
- **Было**: Все данные загружались сразу, а пагинация происходила на клиенте
- **Стало**: Данные загружаются постранично с сервера

### 4. Проблемы с поиском
- **Было**: Поиск работал по уже загруженным данным, а не по серверу
- **Стало**: Поиск выполняется на сервере с правильной пагинацией

### 5. Неправильное вычисление effectivePageSize
- **Было**: Логика ограничения размера страницы работала некорректно
- **Стало**: Правильная логика ограничений для разных тарифов

## Что было изменено

### 1. API клиент (`src/lib/api.ts`)
- Обновлен метод `getLeads` для поддержки серверной пагинации
- Добавлены параметры `page` и `limit`
- Правильная обработка параметров `skipPages` и `pageSize`

### 2. Хук useLeads (`src/hooks/useLeads.ts`)
- Добавлена поддержка серверной пагинации
- Добавлено поле `totalLeads` для общего количества элементов
- Правильная обработка ответов API

### 3. Dashboard (`src/app/app/(protected)/dashboard/page.tsx`)
- Исправлена логика загрузки данных с сервера
- Правильная обработка поиска и фильтрации
- Использование нового компонента пагинации

### 4. LeadsList (`src/components/LeadsList.tsx`)
- Убрана клиентская фильтрация
- Добавлена серверная пагинация
- Правильная обработка смены страниц и размера страницы

### 5. OrdersManagement (`src/components/OrdersManagement.tsx`)
- Упрощена логика пагинации
- Использование нового компонента пагинации
- Правильная обработка состояния

### 6. Новый компонент Pagination (`src/components/ui/pagination.tsx`)
- Универсальный компонент пагинации
- Поддержка селектора размера страницы
- Умная отрисовка номеров страниц
- Адаптивный дизайн

## Как теперь работает пагинация

### 1. Серверная пагинация
- Данные загружаются постранично с сервера
- Каждый запрос содержит параметры `page` и `limit`
- Сервер возвращает данные и общее количество элементов

### 2. Поиск и фильтрация
- Поиск выполняется на сервере
- При изменении параметров поиска сбрасывается на первую страницу
- Правильная обработка debounce для поиска

### 3. Смена страниц
- При смене страницы загружаются новые данные с сервера
- Состояние загрузки отображается корректно
- Кнопки навигации блокируются во время загрузки

### 4. Изменение размера страницы
- При изменении размера страницы сбрасывается на первую страницу
- Данные перезагружаются с новыми параметрами
- Правильное обновление количества страниц

## Преимущества новой реализации

1. **Производительность**: Загружаются только нужные данные
2. **Масштабируемость**: Работает с большими объемами данных
3. **Консистентность**: Все компоненты используют единую логику
4. **UX**: Правильное отображение состояния загрузки
5. **Поддержка**: Легко добавлять новые функции

## Использование

### Базовое использование
```tsx
<Pagination
  currentPage={currentPage}
  totalPages={totalPages}
  onPageChange={handlePageChange}
  itemsPerPage={itemsPerPage}
  totalItems={totalItems}
/>
```

### С селектором размера страницы
```tsx
<Pagination
  currentPage={currentPage}
  totalPages={totalPages}
  onPageChange={handlePageChange}
  onPageSizeChange={handlePageSizeChange}
  itemsPerPage={itemsPerPage}
  totalItems={totalItems}
  showPageSizeSelector={true}
/>
```

### С состоянием загрузки
```tsx
<Pagination
  currentPage={currentPage}
  totalPages={totalPages}
  onPageChange={handlePageChange}
  itemsPerPage={itemsPerPage}
  totalItems={totalItems}
  isLoading={isLoading}
/>
```

## Заключение

Пагинация теперь работает корректно и эффективно. Все компоненты используют единую логику, что упрощает поддержку и развитие проекта. Серверная пагинация обеспечивает хорошую производительность даже с большими объемами данных.
